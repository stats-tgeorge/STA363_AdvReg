{
  "hash": "3fac35afd671a4e2c9a9102617f62c0f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Beyond Least Squares: Using Likelihoods\"\nsubtitle: \"BMLR Chapter 2\"\nformat: \n  revealjs:\n    output-file: \"02_likelihoods_ch2.html\"\n    slide-number: true\n  html:\n    output-file: \"02_likelihoods_ch2_o.html\"\nlogo: \"../img/favicon.png\"\n---\n\n\n## Setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(GGally)\nlibrary(knitr)\nlibrary(patchwork)\nlibrary(viridis)\nlibrary(ggfortify)\n```\n:::\n\n\n## Learning goals \n\n- Describe the concept of a likelihood\n\n- Construct the likelihood for a simple model\n\n- Define the Maximum Likelihood Estimate (MLE) and use it to answer an analysis question\n\n- Identify three ways to calculate or approximate the MLE and apply these methods to find the MLE for a simple model\n\n- Use likelihoods to compare models (next week)\n\n\n\n## What is the likelihood? {.smaller}\n\nA **likelihood** is a function that tells us how likely we are to observe our data for a given parameter value (or values). \n\n- Unlike Ordinary Least Squares (OLS), they do not require the responses be independent, identically distributed, and normal (iidN)\n\n- They are **not** the same as probability functions\n\n. . .\n\n  - **Probability function:** Fixed parameter value(s) + input possible outcomes $\\Rightarrow$ probability of seeing the different outcomes given the parameter value(s)\n  \n\n  \n  - **Likelihood:** Fixed data + input possible parameter values $\\Rightarrow$ probability of seeing the fixed data for each parameter value\n\n\n\n## Fouls in college basketball games {.smaller}\n\nThe data set [`04-refs.csv`](data/04-refs.csv) includes 30 randomly selected NCAA men's basketball games played in the 2009 - 2010 season.\n\nWe will focus on the variables `foul1`, `foul2`, and `foul3`, which indicate which team had a foul called them for the 1st, 2nd, and 3rd fouls, respectively. \n  - `H`: Foul was called on the home team \n  - `V`: Foul was called on the visiting team\n  \n\n\nWe are focusing on the first three fouls for this analysis, but this could easily be extended to include all fouls in a game. \n\n::: footer\n[The dataset was derived from `basektball0910.csv` used in [BMLR Section 11.2](https://bookdown.org/roback/bookdown-BeyondMLR/ch-GLMM.html#cs:refs)\n:::\n\n\n## Fouls in college basketball games\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrefs <- read_csv(\"data/04-refs.csv\")\nrefs %>% slice(1:5) %>% kable()\n```\n\n::: {.cell-output-display}\n\n\n| game|     date|visitor |hometeam |foul1 |foul2 |foul3 |\n|----:|--------:|:-------|:--------|:-----|:-----|:-----|\n|  166| 20100126|CLEM    |BC       |V     |V     |V     |\n|  224| 20100224|DEPAUL  |CIN      |H     |H     |V     |\n|  317| 20100109|MARQET  |NOVA     |H     |H     |H     |\n|  214| 20100228|MARQET  |SETON    |V     |V     |H     |\n|  278| 20100128|SETON   |SFL      |H     |V     |V     |\n\n\n:::\n:::\n\n\nWe will treat the games as independent in this analysis.\n\n\n\n## Different likelihood models {.smaller}\n\n**Model 1 (Unconditional Model)**: What is the probability the referees call a foul on the home team, assuming foul calls within a game are independent? \n\n\n**Model 2 (Conditional Model)**: \n  - Is there a tendency for the referees to call more fouls on the visiting team or home team? \n  - Is there a tendency for referees to call a foul on the team that already has more fouls? \n \n\n\nUltimately we want to decide which model is better.\n\n\n\n## Exploratory data analysis {.smaller}\n\n:::: {.columns}\n::: {.column}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrefs %>%\ncount(foul1, foul2, foul3) %>% kable()\n```\n\n::: {.cell-output-display}\n\n\n|foul1 |foul2 |foul3 |  n|\n|:-----|:-----|:-----|--:|\n|H     |H     |H     |  3|\n|H     |H     |V     |  2|\n|H     |V     |H     |  3|\n|H     |V     |V     |  7|\n|V     |H     |H     |  7|\n|V     |H     |V     |  1|\n|V     |V     |H     |  5|\n|V     |V     |V     |  2|\n\n\n:::\n:::\n\n\n:::\n\n:::{.column}\nThere are \n- 46 total fouls on the home team\n- 44 total fouls on the visiting team \n\n:::\n::::\n\n\n## Model 1: Unconditional model {.smaller}\n\n### What is the probability the referees call a foul on the home team, assuming foul calls within a game are independent? \n\n\n## Likelihood\n\nLet $p_H$ be the probability the referees call a foul on the home team. \n\n**The likelihood for a single observation** \n\n$$Lik(p_H) = p_H^{y_i}(1 - p_H)^{n_i - y_i}$$\n\nWhere $y_i$ is the number of fouls called on the home team. \n\n(In this example, we know $n_i = 3$ for all observations.)\n\n. . .\n\n**Example**\n\nFor a single game where the first three fouls are $H, H, V$, then\n\n$$Lik(p_H) = p_H^{2}(1 - p_H)^{3 - 2} = p_H^{2}(1 - p_H)$$\n\n\n\n## Model 1: Likelihood contribution {.smaller}\n\n\n| Foul1 | Foul2 | Foul3 | n | Likelihood Contribution |\n|-------|-------|-------|---|:-----------------------:|\n| H     | H     | H     | 3 |       $p_H^3$           |\n| H     | H     | V     | 2 |        $p_H^2(1 - p_H)$ |\n| H     | V     | H     | 3 |        $p_H^2(1 - p_H)$ |\n| H     | V     | V     | 7 |       A                 |\n| V     | H     | H     | 7 |        B                |\n| V     | H     | V     | 1 |       $p_H(1 - p_H)^2$  |\n| V     | V     | H     | 5 |         $p_H(1 - p_H)^2$|\n| V     | V     | V     | 2 |         $(1 - p_H)^3$   |\n\n. . .\n\nFill in **A** and **B**.\n\n\n## Model 1: Likelihood function\n\nBecause the observations (the games) are independent, the **likelihood** is\n\n$$Lik(p_H) = \\prod_{i=1}^{n}p_H^{y_i}(1 - p_H)^{3 - y_i}$$\n\n\nWe will use this function to find the **maximum likelihood estimate (MLE)**. The MLE is the value between 0 and 1 where we are most likely to see the observed data.\n\n\n\n## Visualizing the likelihood\n\n:::{.panel-tabset}\n\n### Plot\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](02_likelihoods_ch2_files/figure-revealjs/unnamed-chunk-4-1.png){width=960}\n:::\n:::\n\n\n### Code \n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- seq(0,1, length.out = 100) #sequence of 100 values between 0 and 100\nlik <- p^46 *(1 -p)^44\n\nx <- tibble(p = p, lik = lik)\nggplot(data = x, aes(x = p, y = lik)) + \n  geom_point() + \n  geom_line() +\n  labs(y = \"Likelihood\",\n       title = \"Likelihood of p_H\")\n```\n:::\n\n\n:::\n\n\n## Q: What is your best guess for the MLE, $\\hat{p}_H$?\n\nA. 0.489\n\nB. 0.500\n\nC. 0.511\n\nD. 0.556\n\n## Finding the maximum likelihood estimate \n\nThere are three primary ways to find the MLE \n\n. . .\n\n✅ Approximate using a graph\n\n✅ Numerical approximation \n\n✅ Using calculus\n\n\n\n## Approximate MLE from a graph \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](02_likelihoods_ch2_files/figure-revealjs/unnamed-chunk-6-1.png){width=80%}\n:::\n:::\n\n\n\n\n## Find the MLE using numerical approximation\n\nSpecify a finite set of possible values the for $p_H$ and calculate the likelihood for each value\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# write an R function for the likelihood\nref_lik <- function(ph) {\n  ph^46 *(1 - ph)^44\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# use the optimize function to find the MLE\noptimize(ref_lik, interval = c(0,1), maximum = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$maximum\n[1] 0.5111132\n\n$objective\n[1] 8.25947e-28\n```\n\n\n:::\n:::\n\n\n\n\n## Find MLE using calculus {.smaller}\n\n- Find the MLE by taking the first derivative of the likelihood function. \n\n- This can be tricky because of the Product Rule, so we can maximize the **log(Likelihood)** instead. The same value maximizes the likelihood and log(Likelihood)\n\n\n. . .\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](02_likelihoods_ch2_files/figure-revealjs/unnamed-chunk-9-1.png){width=60%}\n:::\n:::\n\n\n. . .\n\nSince calculus is not a pre-req, we will forgo this quest. \n\n## Model 2: Conditional model \n\n- Is there a tendency for the referees to call more fouls on the visiting team or home team? \n\n- Is there a tendency for referees to call a foul on the team that already has more fouls?\n\n\n\n## Model 2: Likelihood contributions {.smaller}\n\n- Now let's assume fouls are **not** independent within each game. We will specify this dependence using conditional probabilities. \n  - **Conditional probability**: $P(A|B) =$ Probability of $A$ given $B$ has occurred\n\n\n. . .\n\nDefine new parameters:\n\n- $p_{H|N}$: Probability referees call foul on home team given there are equal numbers of fouls on the home and visiting teams \n\n\n\n- $p_{H|H Bias}$: Probability referees call foul on home team given there are more prior fouls on the home team\n\n\n\n- $p_{H|V Bias}$: Probability referees call foul on home team given there are more prior fouls on the visiting team \n\n\n\n## Model 2: Likelihood contributions {.smaller}\n\n| Foul1 | Foul2 | Foul3 | n | Likelihood Contribution |\n|-------|-------|-------|---|:-----------------------:|\n| H     | H     | H     | 3 |       $p_H^3$           |\n| H     | H     | V     | 2 |        $p_H^2(1 - p_H)$ |\n| H     | V     | H     | 3 |        $p_H^2(1 - p_H)$ |\n| H     | V     | V     | 7 |       A                 |\n| V     | H     | H     | 7 |        B                |\n| V     | H     | V     | 1 |        $p_H(1 - p_H)^2$ |\n| V     | V     | H     | 5 |         $p_H(1 - p_H)^2$|\n| V     | V     | V     | 2 |         $(1 - p_H)^3$   |\n\nFill in **A** and **B**\n\n\n\n## Likelihood function \n\n$$\\begin{aligned}Lik(p_{H| N}, p_{H|H Bias}, p_{H |V Bias}) &= [(p_{H| N})^{25}(1 - p_{H|N})^{23}(p_{H| H Bias})^8 \\\\ &(1 - p_{H| H Bias})^{12}(p_{H| V Bias})^{13}(1-p_{H|V Bias})^9]\\end{aligned}$$      \n\n**(Note: The exponents sum to 90, the total number of fouls in the data)**\n\n. . .\n\n\n\n$$\\begin{aligned}\\log (Lik(p_{H| N}, p_{H|H Bias}, p_{H |V Bias})) &= 25 \\log(p_{H| N}) + 23 \\log(1 - p_{H|N}) \\\\ & + 8 \\log(p_{H| H Bias}) + 12 \\log(1 - p_{H| H Bias})\\\\ &+ 13 \\log(p_{H| V Bias}) + 9 \\log(1-p_{H|V Bias})\\end{aligned}$$   \n\n## Q: If fouls within a game are independent, how would you expect $\\hat{p}_H$, $\\hat{p}_{H\\vert H Bias}$ and $\\hat{p}_{H\\vert V Bias}$ to compare? \n\na. $\\hat{p}_H$ is greater than $\\hat{p}_{H\\vert H Bias}$ and $\\hat{p}_{H \\vert V Bias}$\n\nb. $\\hat{p}_{H\\vert H Bias}$ is greater than $\\hat{p}_H$ and $\\hat{p}_{H \\vert V Bias}$\n\nc. $\\hat{p}_{H\\vert V Bias}$ is greater than $\\hat{p}_H$ and $\\hat{p}_{H \\vert V Bias}$\n\nd. They are all approximately equal.\n\n\n\n\n## Q: If there is a tendency for referees to call a foul on the team that already has more fouls, how would you expect $\\hat{p}_H$ and  $\\hat{p}_{H\\vert H Bias}$ to compare? \n\na. $\\hat{p}_H$ is greater than  $\\hat{p}_{H\\vert H Bias}$ \n\nb. $\\hat{p}_{H\\vert H Bias}$ is greater than $\\hat{p}_H$\n\nc. They are approximately equal.\n\n\n## Acknowledgements\n\nThese slides are based on content in [BMLR: Chapter 1 - Review of Multiple Linear Regression](https://bookdown.org/roback/bookdown-BeyondMLR/ch-MLRreview.html)\n\nInitial versions of the slides are by Dr. Maria Tackett, Duke University\n\n\n\n\n\n",
    "supporting": [
      "02_likelihoods_ch2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}